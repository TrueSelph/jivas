import{w as u,v as p,z as x}from"./chunk-QMGIS6GS-CBZUm-7V.js";import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{U as w}from"./UserButton-C7P-xVhi.js";import{B as g}from"./polymorphic-factory-EW0USS3V.js";import{G as f}from"./Group-bnACpcuK.js";import{A as v}from"./ActionIcon-BO4DDcDR.js";import{I as y}from"./IconArrowLeft-4qKQ7vAI.js";import{T as S}from"./Title-B0fFn55O.js";import{D as I}from"./Divider-BI4N1hoX.js";import{C as b}from"./Card-BHrMkZ_V.js";import"./Avatar-BMARKXxx.js";import"./Input-I-MjqIR2.js";import"./CloseButton-BDZlzHA2.js";import"./Loader-1VreoqJz.js";import"./index-B4z8r-Ct.js";import"./events-BOd7YSSb.js";import"./Text-CkpJSrnl.js";import"./Stack-BsPYYAFq.js";import"./Button-BhC08Y9X.js";import"./createReactComponent-CwEnMXT7.js";import"./Paper-k397c_lM.js";import"./create-safe-context-CzEsa9t0.js";function H(){return[{title:"Actions | JIVAS Manager"}]}async function K({request:j}){var c,l,h,d;const o=localStorage.getItem("jivas-host"),n=localStorage.getItem("jivas-token"),s=localStorage.getItem("jivas-agent");if(!o||!n)throw p("/login");const a=s?await fetch(`${o}/walker/get_agent`,{method:"POST",body:JSON.stringify({agent_id:s}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}}).then(r=>{if(r.ok)return r.json();throw localStorage.removeItem("jivas-agent"),p("/login")}).catch(r=>{throw console.log({err:r}),localStorage.removeItem("jivas-agent"),p("/login")}):null,i=new FormData;i.append("args",'{"base64_prefix": false}'),i.append("module_root","actions.jivas.avatar_action"),i.append("agent_id",((l=(c=a==null?void 0:a.reports)==null?void 0:c[0])==null?void 0:l.id)||""),i.append("walker","get_avatar");const e=await fetch(`${o}/action/walker`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:i}).then(async r=>await r.json()).catch(()=>null),m=await fetch(`${o}/walker/list_agents`,{method:"POST",body:JSON.stringify({}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}}).then(r=>r.json()).catch(()=>({reports:[]}));return{selectedAgentInfo:{...((h=a==null?void 0:a.reports)==null?void 0:h[0])||{},thumbnail:!((d=e==null?void 0:e.includes)!=null&&d.call(e,"unable"))&&e&&typeof e=="string"?`data:image/png;base64,${e}`:""},agents:m==null?void 0:m.reports}}const Q=u(function({loaderData:o}){const n=localStorage.getItem("jivas-host"),s=localStorage.getItem("jivas-root-id");return t.jsxs(g,{px:"xl",children:[t.jsxs(f,{justify:"space-between",children:[t.jsxs(f,{children:[t.jsx(v,{color:"dark",size:"sm",component:x,to:"/dashboard",children:t.jsx(y,{})}),t.jsx(S,{order:3,children:"Graph"})]}),t.jsx(g,{children:t.jsx(w,{selectedAgentInfo:o.selectedAgentInfo||null,agents:o.agents})})]}),t.jsx(I,{mt:"xs",mb:"sm"}),t.jsx(b,{px:"0",py:"0",h:"86vh",withBorder:!0,pos:"relative",children:t.jsx("jvgraph-viewer",{className:"min-h-[740px]",host:n,root_node:s,host:n,style:{width:"100%",height:"100%",border:"none",outline:"none"}},o.selectedAgentInfo.id)})]})});export{K as clientLoader,Q as default,H as meta};
